#!/usr/bin/python3

# `json` is a script used to format json data either
# from a file or stdin and print it to stdout.

import argparse
import json
import os
import sys
import traceback

class File:
  def __init__(self, path):
    self.path = path
    _, ext = self.parts
    if ext != '.json':
      die('Invalid file type.')

  @property
  def last(self):
    return os.path.basename(os.path.normpath(self.path))

  @property
  def parts(self):
    return os.path.splitext(self.last)

  @property
  def out(self):
    try:
      with open(self.path, 'r') as file:
        print(
          json.dumps(
            json.load(file),
            indent = 2
          )
        )
    except Exception as error:
      die(f'Failure to format JSON: {error}')
    sys.exit(0)

def e(*args, **kwargs):
  print(*args, **kwargs, file=sys.stderr)

def die(*args, **kwargs):
  e(*args, **kwargs)
  sys.exit(-1)

def main(args):
  if os.path.exists(args):
    File(args).out

  print(
    json.dumps(
      args,
      indent = 2
    )
  )

if __name__ == '__main__':
  if len(sys.argv) != 2:
    die('usage: json <path|input>')
  main(sys.argv[1])
